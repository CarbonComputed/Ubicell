{% extends "index.html" %}

<html>
<head>
	{%block scripts%}
		<!-- <link rel="stylesheet" href="/static/styles/me.css" type="text/css" /> -->

	{%end%}
</head>
<body>
	{%block container%}
	<div id="container" class="user">
        {%module LeftSideModule(current_user['_id']['$oid'])%}

		<div id="content">
			<div id="user-data">
				<div class="proimg">
					<img  src="/images?picid={{escape(userdata['ProfileImg']['$oid'])}}" height="150" width="150">
					<span class="changepro"><a href="/actions/edit_profile">Edit</a></span>
				</div>
				<div class="user-description">
					<h2>{{escape(userdata['FirstName']).capitalize()}} {{escape(userdata['LastName']).capitalize()}}</h2></br>
					<h3>{{escape(userdata['School']['Major'])}}, {{userdata['School']['GradYear']}}</h3>
					<p>About Me: {{escape(userdata['About'])}}</p>
				</br>
				<a href="photos">Photos</a>
				<a href="friends">Friends</a>
			</div>

		</div>
		<div class="clear"></div>
		<div id="Status">
			<form action="#" onsubmit="post($('#status-text').data('networkid'),null,null);return false;">
                    <textarea id="status-text" class="status-box" type="text" name="status" placeholder="Whatsup {{current_user['FirstName'].capitalize()}}?"></textarea>
                    <input class="status-button" type="submit" value="Post!" >
                </form>
		</div>
            <div id="status-feed">
                {%for post in feed%}
                    {%module PostModule(me,post,uniname,detailed=False)%}
                {%end%}

            </div>

	</div>
</div>
{%end%}

{%block funcs%}

<script type="text/javascript">
$(document).endlessScroll({
  fireOnce: false,
  fireDelay: 500,
  loader:'<div id="loading"><img src="/static/images/ajax-loader.gif"></div>',
  insertBefore: '#Status-Feed',
  resetCounter: function(){
  	if(clicked == true){
  		clicked = false;
  		return true;
  	}
  	return false;
  },
  content: function(fireSeq,pageSeq,scrollDir){
  	if(pageSeq < 0){
  				var u = "/actions/feed";
  				if(document.URL.indexOf("?") < 0){
  					u = u+"?page="+fireSeq
  				}
  				else{
  					u = u+"&page="+fireSeq
  				}
  				u = u + "&user_id={{userdata['_id']['$oid']}}"

  				var content ="";
			  	$.ajax({
			  	type : "GET",
			    url: u,
			    success: function(data) {
			    	console.log(data);
			      	data = $('<div/>').html(data).contents().eq(1);
			      	
		  		 	//console.log($(data).find('#Status-Feed').html());
		   			content = $(data).html();
		   			console.log(content);
			    },

			    async:false
			  	});
			  	//console.log(content);
		  		return content;
		  		 //console.log(data);
		  		 
  		//console.log($.get("/?page="+fireSeq+" #Status-Feed"));
  		//return $.get("/?page="+fireSeq+" #Status-Feed").responseText;
  	}
  	
  },
  callback: function(p){
    //alert("test");
  }
});

$('.changepro').hide();
$('.proimg').hover(function(){
    $('.changepro').show();
}, function() {
   $('.changepro').hide();
});
</script>

{%end%}
</body>
</html>